function closeAllInfoWindows(){for(var e=0;e<infoWindows.length;e++)infoWindows[e].close()}function setMarkers(e,t){for(var n=0;n<t.spots.length;n++){var o=t.spots[n],s=o.Id,i=o.Name,a=t.spots[n].Latitude,c=t.spots[n].Longitude,r="img/icon-marker.png";if(""!=a&&""!=c){"Kite"==o.Category&&(r="img/icon-marker-kite.png"),"Cable"==o.Category&&(r="img/icon-marker-wake.png");var p=new google.maps.LatLng(a,c),g=new google.maps.Marker({map:e,title:i,position:p,icon:r}),u=new google.maps.InfoWindow;infoWindows.push(u);var d='<h4 style="min-width: 110px;">'+i+'</h4><div class="clearfix"><p style="margin: 0;"><i class="icon ion-android-car"></i>'+o.DrivingDistance+'</p><p><i class="icon ion-android-time"></i>'+o.DrivingDuration+'</p></div><p><a href="#/spot/'+s+'" class="button button-outline button-positive">Se spottet</a></p>';google.maps.event.addListener(g,"click",function(t,n,o){return function(){closeAllInfoWindows(),o.setContent(n),o.open(e,t)}}(g,d,u))}}}function createGoogleMaps(e,t){var n=new google.maps.LatLng(55.861175,9.845964),o={center:n,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map"),o);s.setCenter(t),new google.maps.Marker({position:t,map:s,title:"My Location",icon:"img/icon-marker.png"}),setMarkers(s,e),e.map=s}function loadMapDelayed(e,t,n){"map"!=t.name||e.pageFailed?e.mapActive=!1:(e.mapActive=!0,e.mapCreated||(e.isLoading=!0,e.loadingMessage="Henter kort",setTimeout(function(){createGoogleMaps(e,n.getCurrentPosition())},1e3),setTimeout(function(){e.isLoading=!1,e.loadingMessage="",e.mapCreated=!0,e.$apply(),console.log("map created")},2e3)))}function stateChange(e,t,n,o,s,i){console.log("toStateName",t.name),stateChangeAnimation(e,t),ignoreMessagesOnStateChange(e,t),emptyCurrentSpot(e,t,n,s,i),stateChangeLoading(e,t),loadMapDelayed(e,t,o)}function stateChangeLoading(e,t){"spot"==t.name&&(e.isLoading=!0,e.loadingMessage="Henter detaljer")}function ignoreMessagesOnStateChange(e,t){"info"==t.name?e.ignoreMessages=!0:e.ignoreMessages=!1}function emptyCurrentSpot(e,t,n,o,s){"spot"!=t.name?(e.currentSpot=null,e.currentSpotImage=null):spots.getCurrentSpot(e,o,n.spotId,s)}function stateChangeAnimation(e,t){var n=t.name,o="tab-nav--hide",s="header-filter--hide";$("body").addClass("state--change"),setTimeout(function(){$("body").removeClass("state--change")},200),"list"==n?$("body").removeClass(s):$("body").addClass(s),"nameOfViwe"==n?$("body").addClass(o):$("body").removeClass(o)}var checkIn={init:function(e,t,n,o){e.checkIn=function(){e.inProgress=!0,e.currentSpot.CheckIns="...",null===e.checkedInId||"null"===e.checkedInId?checkIn.checkIn(e,t,n,o):(n.checkOutOnSpot(e.checkedInId),console.log("checked out before checking in, id:",e.checkedInId),setTimeout(function(){checkIn.checkIn(e,t,n,o)},500))},e.checkOut=function(){e.inProgress=!0,e.currentSpot.CheckIns="...",checkIn.checkOut(e,t,n,o)}},checkIn:function(e,t,n,o){n.checkInOnSpot(e.currentSpot.Id).success(function(){e.inProgress=!1,e.checkedInId=e.currentSpot.Id,t.localStorage.checkedInId=e.currentSpot.Id,console.log("checked in, id:",e.checkedInId),spots.getCurrentSpot(e,n,e.currentSpot.Id,o)}).error(function(){alert("*** ERROR *** Check-In")})},checkOut:function(e,t,n,o){n.checkOutOnSpot(e.checkedInId).success(function(){console.log("checked out, id:",e.checkedInId),e.inProgress=!1,e.checkedInId=null,t.localStorage.checkedInId=null,spots.getCurrentSpot(e,n,e.currentSpot.Id,o)}).error(function(){alert("*** ERROR *** Check-Out")})}},infoWindows=[];!function(){"use strict";function e(e,t){function n(){var t="/Umbraco/Api/Spots/GetAllSpots",n=a+t;return e.get(n)}function o(t){var n="/Umbraco/Api/Spots/GetSpotById?spotId="+t,o=a+n;return e.get(o)}function s(t){var n="/Umbraco/Api/Spots/CheckIn?spotId="+t,o=a+n;return e.post(o)}function i(t){var n="/Umbraco/Api/Spots/CheckOut?spotId="+t,o=a+n;return e.post(o)}this.getAllSpots=n,this.getSpotById=o,this.checkInOnSpot=s,this.checkOutOnSpot=i;var a=t.domain}angular.module("app").service("spotsService",e),e.$inject=["$http","settings"]}();var spots={init:function(){},getAllSpots:function(e,t,n,o){n.getAllSpots().success(function(t){e.spots=t,e.loadingMessage="",console.log("success",t),spots.getCurrentPosition(0,e,o)}).error(function(){alert("*** ERROR *** All Spots"),e.pageFailed=!0,e.isLoading=!1,e.loadingMessage=""})},getCurrentSpot:function(e,t,n,o){t.getSpotById(n).success(function(t){console.log("getCurrentSpot",t),e.currentSpot=t,e.currentSpotImage=o.domain+e.currentSpot.Image+"?width=400&height=200&mode=crop&format=jpg",e.currentSpotMapsLink="http://maps.google.com/?q="+e.currentSpot.Latitude+","+e.currentSpot.Longitude,e.currentSpot.Weather&&(e.currentSpotWindDegCorrected=-45+e.currentSpot.Weather.WindDirectionDeg+180),setTimeout(function(){e.isLoading=!1,e.loadingMessage="",e.$apply()},500)}).error(function(){alert("*** ERROR *** Current Spot"),e.pageFailed=!0,e.isLoading=!1,e.loadingMessage=""})},getCurrentPosition:function(e,t,n){return e++,t.loadingMessage="Beregner afstande",console.log("getCurrentPosition CountAttempts",e),e>=5?(t.isLoading=!1,t.loadingMessage="",void t.$apply()):void(null!=n.getCurrentPosition()?(spots.updateSpotsDistanceInfo(t,n),null!=t.currentSpot&&n.updateItemDistanceInfo(t.currentSpot)):setTimeout(function(){spots.getCurrentPosition(e,t,n)},2e3))},updateSpotsDistanceInfo:function(e,t){console.log("updateSpotsDistanceInfo");for(var n=0;n<e.spots.length;n++){var o=e.spots[n];""!=o.Latitude&&""!=o.Longitude&&t.updateItemDistanceInfo(o)}setTimeout(function(){e.isLoading=!1,e.loadingMessage="",e.$apply()},500)}};