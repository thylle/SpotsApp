!function(){function t(t,o,n,e){o.isLoading=!0,o.spots=[],o.currentSpot=null,o.mapCreated=!1;var i=null,r={init:function(){r.getAllSpots()},getAllSpots:function(){e.getAllSpots().success(function(t){o.spots=t,console.log("success",t),r.getCurrentPosition(0)}).error(function(t){alert("*** ERROR *** All Spots",t)})},getCurrentPosition:function(t){return t++,console.log("getCurrentPosition CountAttempts",t),t>=5?void hideLoading(o):(navigator.geolocation.getCurrentPosition(function(t){i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude)}),void(null!=i?(r.addDistanceToSpots(),null!=o.currentSpot&&r.addDistanceToCurrentSpot(o.currentSpot)):n(function(){r.getCurrentPosition(t)},1e3)))},addDistanceToSpots:function(){console.log("addDistanceToSpots");for(var t=0;t<o.spots.length;t++){var e=o.spots[t];""!=e.Latitude&&""!=e.Longitude&&(e.Distance=getDistanceFromCurrentPosition(i,e.Latitude,e.Longitude))}n(function(){hideLoading(o)},800)},addDistanceToCurrentSpot:function(t){""!=t.Latitude&&""!=t.Longitude&&null!=i&&(t.Distance=getDistanceFromCurrentPosition(i,t.Latitude,t.Longitude))}};$(window).load(function(){r.init()}),t.$on("$stateChangeSuccess",function(t,s,u,a,c){stateChange(s),"spot"==s.name?e.getSpotById(u.spotId).success(function(t){o.currentSpot=t,r.addDistanceToCurrentSpot(o.currentSpot)}).error(function(){alert("ERROR GETTING CURRENT SPOT")}):o.currentSpot=null,n(function(){var t=$("#map");t.length<=0&&(o.mapCreated=!1),!o.mapCreated&&t.length>0&&(createGoogleMaps(o,i),o.mapCreated=!0)},1e3)})}t.$inject=["$rootScope","$scope","$timeout","spotsService"],angular.module("app").controller("baseController",t)}();