function showLoading(o){o.isLoading=!0}function hideLoading(o){setTimeout(function(){o.isLoading=!1},800)}function closeAllInfoWindows(){for(var o=0;o<infoWindows.length;o++)infoWindows[o].close()}function setMarkers(o,t){for(var e=0;e<t.spots.length;e++){var n=t.spots[e].Name,s=t.spots[e].Latitude,i=t.spots[e].Longitude,a="http://labs.google.com/ridefinder/images/mm_20_blue.png";if(""!=s&&""!=i){"Kite"==t.spots[e].Category&&(a="http://labs.google.com/ridefinder/images/mm_20_orange.png");var r=new google.maps.LatLng(s,i),c=new google.maps.Marker({map:o,title:n,position:r,icon:a}),p=new google.maps.InfoWindow;infoWindows.push(p);var g="<h5>"+n+"</h5>";google.maps.event.addListener(c,"click",function(t,e,n){return function(){closeAllInfoWindows(),n.setContent(e),n.open(o,t)}}(c,g,p))}}}function createGoogleMaps(o,t){console.log("creating map");var e=new google.maps.LatLng(55.861175,9.845964),n={center:e,zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map"),n);s.setCenter(t),new google.maps.Marker({position:t,map:s,title:"My Location",icon:{path:google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,scale:4,fillColor:"#f8ae5f"}}),setMarkers(s,o),o.map=s}function stateChange(o){var t=o.name,e="tab-nav--hide",n="header-filter--hide";$("body").addClass("state--change"),setTimeout(function(){$("body").removeClass("state--change")},200),"list"==t?$("body").removeClass(n):$("body").addClass(n),"list"==t||"map"==t?$("body").removeClass(e):$("body").addClass(e)}var loadingContainer=$(".message__container"),loadingContent=$(loadingContainer).find(".message__spinner"),loadingElementClone="",loadingActiveClass="message__container--active",infoWindows=[];!function(){"use strict";function o(o,t){function e(){var t="/Umbraco/Api/Spots/GetAllSpots",e=i+t;return o.get(e)}function n(t){var e="/Umbraco/Api/Spots/GetSpotById?spotId="+t,n=i+e;return o.get(n)}function s(t){var e="/Umbraco/Api/Spots/CheckIn?spotId="+t,n=i+e;return o.post(n)}this.getAllSpots=e,this.getSpotById=n,this.checkInOnSpot=s;var i=t.domain}angular.module("app").service("spotsService",o),o.$inject=["$http","settings"]}();var spots={init:function(){},getAllSpots:function(o,t,e,n){e.getAllSpots().success(function(t){o.spots=t,console.log("success",t),spots.getCurrentPosition(0,o,n)}).error(function(){alert("*** ERROR *** All Spots"),o.pageFailed=!0,o.isLoading=!1})},getCurrentSpot:function(o,t,e,n){t.getSpotById(e).success(function(t){console.log("getCurrentSpot",t),o.currentSpot=t,o.currentSpotImage=n.domain+o.currentSpot.Image+"?width=400&height=200&mode=crop&format=jpg"}).error(function(){alert("*** ERROR *** Current Spot"),o.pageFailed=!0,o.isLoading=!1})},getCurrentPosition:function(o,t,e){return o++,console.log("getCurrentPosition CountAttempts",o),o>=5?(t.isLoading=!1,void t.$apply()):void(null!=e.getCurrentPosition()?(spots.updateSpotsDistanceInfo(t,e),null!=t.currentSpot&&e.updateItemDistanceInfo(t.currentSpot)):setTimeout(function(){spots.getCurrentPosition(o,t,e),t.isLoading=!1},2e3))},updateSpotsDistanceInfo:function(o,t){console.log("updateSpotsDistanceInfo");for(var e=0;e<o.spots.length;e++){var n=o.spots[e];""!=n.Latitude&&""!=n.Longitude&&t.updateItemDistanceInfo(n)}o.isLoading=!1},checkIn:function(o,t,e){null!=o.currentSpot&&(o.userCheckedIn=!0,t.checkInOnSpot(o.currentSpot.Id).success(function(n){console.log("check-in success",n),spots.getCurrentSpot(o,t,o.currentSpot.Id,e)}).error(function(){alert("*** ERROR *** Check-In"),o.userCheckedIn=!1,o.pageFailed=!0,o.isLoading=!1}))}};