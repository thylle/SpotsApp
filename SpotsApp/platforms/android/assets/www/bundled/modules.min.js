function closeAllInfoWindows(){for(var e=0;e<infoWindows.length;e++)infoWindows[e].close()}function setMarkers(e,t){for(var n=0;n<t.spots.length;n++){var o=t.spots[n],s=o.Id,i=o.Name,a=t.spots[n].Latitude,r=t.spots[n].Longitude,c="img/icon-marker.png";if(""!=a&&""!=r){"Kite"==o.Category&&(c="img/icon-marker-kite.png"),"Cable"==o.Category&&(c="img/icon-marker-wake.png");var p=new google.maps.LatLng(a,r),u=new google.maps.Marker({map:e,title:i,position:p,icon:c}),g=new google.maps.InfoWindow;infoWindows.push(g);var l='<h4 style="min-width: 110px;">'+i+'</h4><div class="clearfix"><p style="margin: 0;"><i class="icon ion-android-car"></i>'+o.DrivingDistance+'</p><p><i class="icon ion-android-time"></i>'+o.DrivingDuration+'</p></div><p><a href="#/spot/'+s+'" class="button button-outline button-positive">Se spottet</a></p>';google.maps.event.addListener(u,"click",function(t,n,o){return function(){closeAllInfoWindows(),o.setContent(n),o.open(e,t)}}(u,l,g))}}}function createGoogleMaps(e,t){console.log("creating map");var n=new google.maps.LatLng(55.861175,9.845964),o={center:n,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map"),o);s.setCenter(t),new google.maps.Marker({position:t,map:s,title:"My Location",icon:"img/icon-marker.png"}),setMarkers(s,e),e.map=s}function stateChange(e,t,n,o,s,i){console.log("toStateName",t.name),stateChangeAnimation(e,t),ignoreMessagesOnStateChange(e,t),emptyCurrentSpot(e,t,n,s,i),loadMapDelayed(e,t,o)}function ignoreMessagesOnStateChange(e,t){"about"==t.name?e.ignoreMessages=!0:e.ignoreMessages=!1}function loadMapDelayed(e,t,n){"map"==t.name&&setTimeout(function(){var t=$("#map");t.length<=0&&(e.mapCreated=!1),!e.mapCreated&&t.length>0&&(createGoogleMaps(e,n.getCurrentPosition()),e.mapCreated=!0)},1e3)}function emptyCurrentSpot(e,t,n,o,s){"spot"!=t.name?(e.currentSpot=null,e.currentSpotImage=null):spots.getCurrentSpot(e,o,n.spotId,s)}function stateChangeAnimation(e,t){var n=t.name,o="tab-nav--hide",s="header-filter--hide";$("body").addClass("state--change"),setTimeout(function(){$("body").removeClass("state--change")},200),"list"==n?$("body").removeClass(s):$("body").addClass(s),"nameOfViwe"==n?$("body").addClass(o):$("body").removeClass(o)}function showLoading(e){e.isLoading=!0}function hideLoading(e){setTimeout(function(){e.isLoading=!1},800)}var checkIn={toggle:function(e,t,n,o){null!=e.currentSpot&&(e.userCheckedIn===!1?(e.userCheckedIn=!0,t.localStorage.userCheckedIn=!0,e.currentSpot.CheckIns="...",n.checkInOnSpot(e.currentSpot.Id).success(function(t){console.log("check-in success",t),spots.getCurrentSpot(e,n,e.currentSpot.Id,o)}).error(function(){alert("*** ERROR *** Check-In"),e.userCheckedIn=!1})):(e.userCheckedIn=!1,t.localStorage.userCheckedIn=!1,e.currentSpot.CheckIns="...",n.checkOutOnSpot(e.currentSpot.Id).success(function(t){console.log("check-out success",t),spots.getCurrentSpot(e,n,e.currentSpot.Id,o)}).error(function(){alert("*** ERROR *** Check-In"),e.userCheckedIn=!0})))}},infoWindows=[];!function(){"use strict";function e(e,t){function n(){var t="/Umbraco/Api/Spots/GetAllSpots",n=a+t;return e.get(n)}function o(t){var n="/Umbraco/Api/Spots/GetSpotById?spotId="+t,o=a+n;return e.get(o)}function s(t){var n="/Umbraco/Api/Spots/CheckIn?spotId="+t,o=a+n;return e.post(o)}function i(t){var n="/Umbraco/Api/Spots/CheckOut?spotId="+t,o=a+n;return e.post(o)}this.getAllSpots=n,this.getSpotById=o,this.checkInOnSpot=s,this.checkOutOnSpot=i;var a=t.domain}angular.module("app").service("spotsService",e),e.$inject=["$http","settings"]}();var spots={init:function(){},getAllSpots:function(e,t,n,o){n.getAllSpots().success(function(t){e.spots=t,console.log("success",t),spots.getCurrentPosition(0,e,o)}).error(function(){alert("*** ERROR *** All Spots"),e.pageFailed=!0,e.isLoading=!1})},getCurrentSpot:function(e,t,n,o){t.getSpotById(n).success(function(t){console.log("getCurrentSpot",t),e.currentSpot=t,e.currentSpotImage=o.domain+e.currentSpot.Image+"?width=400&height=200&mode=crop&format=jpg",e.currentSpotMapsLink="http://maps.google.com/?q="+e.currentSpot.Latitude+","+e.currentSpot.Longitude,e.currentSpotWindDegCorrected=-45+e.currentSpot.Weather.WindDirectionDeg+180}).error(function(){alert("*** ERROR *** Current Spot"),e.pageFailed=!0,e.isLoading=!1})},getCurrentPosition:function(e,t,n){return e++,console.log("getCurrentPosition CountAttempts",e),e>=5?(t.isLoading=!1,void t.$apply()):void(null!=n.getCurrentPosition()?(spots.updateSpotsDistanceInfo(t,n),null!=t.currentSpot&&n.updateItemDistanceInfo(t.currentSpot)):setTimeout(function(){spots.getCurrentPosition(e,t,n),t.isLoading=!1},2e3))},updateSpotsDistanceInfo:function(e,t){console.log("updateSpotsDistanceInfo");for(var n=0;n<e.spots.length;n++){var o=e.spots[n];""!=o.Latitude&&""!=o.Longitude&&t.updateItemDistanceInfo(o)}e.isLoading=!1}},loadingContainer=$(".message__container"),loadingContent=$(loadingContainer).find(".message__spinner"),loadingElementClone="",loadingActiveClass="message__container--active";