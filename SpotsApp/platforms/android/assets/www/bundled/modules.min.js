function closeAllInfoWindows(){for(var e=0;e<infoWindows.length;e++)infoWindows[e].close()}function setMarkers(e,t){for(var o=0;o<t.spots.length;o++){var n=t.spots[o],s=n.Id,a=n.Name,i=t.spots[o].Latitude,r=t.spots[o].Longitude,c="img/icon-marker.png";if(""!=i&&""!=r){"Kite"==n.Category&&(c="img/icon-marker-kite.png"),"Cable"==n.Category&&(c="img/icon-marker-wake.png");var p=new google.maps.LatLng(i,r),g=new google.maps.Marker({map:e,title:a,position:p,icon:c}),u=new google.maps.InfoWindow;infoWindows.push(u);var l='<h4 style="min-width: 110px;">'+a+'</h4><div class="clearfix"><p style="margin: 0;"><i class="icon ion-android-car"></i>'+n.DrivingDistance+'</p><p><i class="icon ion-android-time"></i>'+n.DrivingDuration+'</p></div><p><a href="#/spot/'+s+'" class="button button-outline button-positive">Se spottet</a></p>';google.maps.event.addListener(g,"click",function(t,o,n){return function(){closeAllInfoWindows(),n.setContent(o),n.open(e,t)}}(g,l,u))}}}function createGoogleMaps(e,t){var o=new google.maps.LatLng(55.861175,9.845964),n={center:o,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map"),n);s.setCenter(t),new google.maps.Marker({position:t,map:s,title:"My Location",icon:"img/icon-marker.png"}),setMarkers(s,e),e.map=s}function loadMapDelayed(e,t,o){"map"!=t.name||e.pageFailed?e.mapActive=!1:(e.mapActive=!0,e.mapCreated||(e.isLoading=!0,e.loadingMessage="Henter kort",setTimeout(function(){createGoogleMaps(e,o.getCurrentPosition())},1e3),setTimeout(function(){e.isLoading=!1,e.loadingMessage="",e.mapCreated=!0,e.$apply(),console.log("map created")},2e3)))}function stateChange(e,t,o,n,s,a){console.log("toStateName",t.name),stateChangeAnimation(e,t),ignoreMessagesOnStateChange(e,t),emptyCurrentSpot(e,t,o,s,a),stateChangeLoading(e,t),loadMapDelayed(e,t,n)}function stateChangeLoading(e,t){"spot"==t.name&&(e.isLoading=!0,e.loadingMessage="Henter detaljer")}function ignoreMessagesOnStateChange(e,t){"info"==t.name?e.ignoreMessages=!0:e.ignoreMessages=!1}function emptyCurrentSpot(e,t,o,n,s){"spot"!=t.name?(e.currentSpot=null,e.currentSpotImage=null):spots.getCurrentSpot(e,n,o.spotId,s)}function stateChangeAnimation(e,t){var o=t.name,n="tab-nav--hide",s="header-filter--hide";$("body").addClass("state--change"),setTimeout(function(){$("body").removeClass("state--change")},200),"list"==o?$("body").removeClass(s):$("body").addClass(s),"nameOfViwe"==o?$("body").addClass(n):$("body").removeClass(n)}var checkIn={toggle:function(e,t,o,n){null!=e.currentSpot&&(e.userCheckedIn===!1?(e.userCheckedIn=!0,t.localStorage.userCheckedIn=!0,e.currentSpot.CheckIns="...",o.checkInOnSpot(e.currentSpot.Id).success(function(t){console.log("check-in success",t),spots.getCurrentSpot(e,o,e.currentSpot.Id,n)}).error(function(){alert("*** ERROR *** Check-In"),e.userCheckedIn=!1})):(e.userCheckedIn=!1,t.localStorage.userCheckedIn=!1,e.currentSpot.CheckIns="...",o.checkOutOnSpot(e.currentSpot.Id).success(function(t){console.log("check-out success",t),spots.getCurrentSpot(e,o,e.currentSpot.Id,n)}).error(function(){alert("*** ERROR *** Check-In"),e.userCheckedIn=!0})))}},infoWindows=[];!function(){"use strict";function e(e,t){function o(){var t="/Umbraco/Api/Spots/GetAllSpots",o=i+t;return e.get(o)}function n(t){var o="/Umbraco/Api/Spots/GetSpotById?spotId="+t,n=i+o;return e.get(n)}function s(t){var o="/Umbraco/Api/Spots/CheckIn?spotId="+t,n=i+o;return e.post(n)}function a(t){var o="/Umbraco/Api/Spots/CheckOut?spotId="+t,n=i+o;return e.post(n)}this.getAllSpots=o,this.getSpotById=n,this.checkInOnSpot=s,this.checkOutOnSpot=a;var i=t.domain}angular.module("app").service("spotsService",e),e.$inject=["$http","settings"]}();var spots={init:function(){},getAllSpots:function(e,t,o,n){o.getAllSpots().success(function(t){e.spots=t,e.loadingMessage="",console.log("success",t),spots.getCurrentPosition(0,e,n)}).error(function(){alert("*** ERROR *** All Spots"),e.pageFailed=!0,e.isLoading=!1,e.loadingMessage=""})},getCurrentSpot:function(e,t,o,n){t.getSpotById(o).success(function(t){console.log("getCurrentSpot",t),e.currentSpot=t,e.currentSpotImage=n.domain+e.currentSpot.Image+"?width=400&height=200&mode=crop&format=jpg",e.currentSpotMapsLink="http://maps.google.com/?q="+e.currentSpot.Latitude+","+e.currentSpot.Longitude,e.Weather&&(e.currentSpotWindDegCorrected=-45+e.currentSpot.Weather.WindDirectionDeg+180),setTimeout(function(){e.isLoading=!1,e.loadingMessage="",e.$apply()},1500)}).error(function(){alert("*** ERROR *** Current Spot"),e.pageFailed=!0,e.isLoading=!1,e.loadingMessage=""})},getCurrentPosition:function(e,t,o){return e++,t.loadingMessage="Beregner afstande",console.log("getCurrentPosition CountAttempts",e),e>=5?(t.isLoading=!1,t.loadingMessage="",void t.$apply()):void(null!=o.getCurrentPosition()?(spots.updateSpotsDistanceInfo(t,o),null!=t.currentSpot&&o.updateItemDistanceInfo(t.currentSpot)):setTimeout(function(){spots.getCurrentPosition(e,t,o)},2e3))},updateSpotsDistanceInfo:function(e,t){console.log("updateSpotsDistanceInfo");for(var o=0;o<e.spots.length;o++){var n=e.spots[o];""!=n.Latitude&&""!=n.Longitude&&t.updateItemDistanceInfo(n)}e.isLoading=!1,e.loadingMessage=""}};